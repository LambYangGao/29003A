\# 1 系统概述 ## 1.1 系统组成 光电分系统包含高清可见光探测（彩色）、制冷红外探测、激光测距、综合图像处理、控制终端等。与雷达等其他分系统协同工作，完成对前级引导进入视场范围内的小微无人机目标的检测、捕获、脱靶量实时上报。 ## 1.2 光电分系统工作流程： 1）系统上电并检查确认各分机工作状态正常；2）调整设备主要初始参数，变倍、调焦、增益等，并根据场景特征调用预置位；3）目标经由前级引导进入视场；3）检测到视场内疑似目标并完成目标指示；4）手动/自动跟踪目标并实时向指控上报脱靶量，供总体完成目标闭环打击；5)退出跟踪进入待机状态。 另外，需要考虑到激光禁射角度设置，在整车驻车展开并标校无误后，由操作人员根据周围场景，通过操控天线指向并观察画面，进而记录当前周视范围内存在有遮挡的、有明确要求不允许照射激光的方位、俯仰区域角度，在指控界面开辟禁射区域角度的输入框，在进行激光测距时，由指控进行判别，当天线转动到禁射区域后，后台指令激光测距组件关闭。设备的截获转跟踪可以选择手动/自动方式，手动模式下，比如点击鼠标右键启动，再次右键则退出；也可以通过自动方式实现，在选择自动模式后，当雷达引导目标后，自动根据雷达的目标距离切换到合适的视场，信息画面中出现无人机，目标检测程序通常通过3帧左右的积累辨别，自动检测出目标并锁定，进入跟踪状态，目标运动过程中，根据实时反馈的雷达距离信息或者画面内的跟踪目标的像素大小，自动进行变倍和聚焦动作，确保变焦过程的画面清晰，确保目标持续稳定跟踪，进而实现典型场景下的无人值守。 ## 1.3 系统工作流程 光电分系统信息处理软件主要处理流程：接收指控雷达引导指令，若开启引导模式，光电分系统视场内捕获到目标时，通过AI算法对视场内目标进行识别、分类和计数，同时进入目标自动跟踪模式，系统锁定移动的目标，基于目标偏离视场中心的位置持续上报脱靶量，联动转台确保目标始终保持在视场中心位置；不开启引导模式的状态下，可选择是否使用手动跟踪模式。通过指控显控端鼠标点击目标，下发目标定点跟踪指令，进入目标手动跟踪模式。该功能可在鼠标点击的指定区域精准跟踪目标的位置。跟踪算法输出锁定目标的脱靶量至伺服转台。AI算法识别到目标后，将识别到的目标信息通过OSD 叠加到视频图像上，输出视频至指控。 目标跟踪主要有手动跟踪和自动跟踪两中模式，处理流程分别如下所示： a) 手动跟踪流程：需要雷达引导或操作人员来给出指定跟踪位置，引导伺服将跟踪目标位置转到画面中心，同时根据当前帧的无人机目标检测结果，判断跟踪位置是否存在无人机目标，从而选择使用模板跟踪还是检测跟踪。当跟踪位置不存在无人机目标时，说明引导的跟踪目标并非无人机目标，此时以目标区域为中心，使用模板跟踪算法跟踪目标。模板跟踪以制定的目标为模板，在当前帧目标周围中查找与模板相关性最高的位置，为当前目标位置，从而持续跟踪。当模板匹配分数小于设定阈值时，此时目标可能受到遮挡的干扰，此时记忆跟踪4秒，判断模板匹配分数是否重新高于阈值，高于阈值时说明目标重新出现，继续跟踪，没有高于阈值则说明目标丢失，此时释放跟踪，退出跟踪状态。操作人员在跟踪时可以手动选择释放跟踪，从而退出模板跟踪，伺服保持当前位置。当跟踪位置存在无人机目标时，说明引导的跟踪目标为无人机目标，此时以目标位置为中心，截取一个跟踪窗口，在目标周围始终使用AI检测来检测无人机目标并更新目标轨迹，从而持续跟踪。当目标受到云雾遮挡等干扰丢失目标时，此时记忆跟踪目标4秒，持续检测目标丢失区域是否会重新捕获无人机目标，当目标重新捕获时，继续跟踪状态，当记忆跟踪4秒没有重新捕获目标时，释放并退出跟踪。 b）自动跟踪流程：首先对整幅图像进行无人机目标检测，记录所有目标的检测位置并形成多帧轨迹，通过多帧轨迹关联来过滤漏检和误检，通过多帧检测后，如果存在连续的无人机目标轨迹，则进入检测跟踪状态，上报发现无人机目标。如果存在多个符合要求的目标，则根据目标检测的置信度分数选择分数最大的无人机目标作为跟踪目标，进入检测跟踪状态，当目标受到遮挡等干扰丢失目标时，进入记忆跟踪状态，持续检测目标丢失区域是否会重新捕获无人机目标，当目标重新捕获时，继续跟踪状态，当记忆跟踪4秒没有重新捕获目标时，上报目标丢失，释放并退出跟踪。 c）自动变倍聚焦跟踪流程：为确保持续、稳定的目标识别与跟踪，在识别跟踪模块中还集成了自动变倍聚焦联动控制模块。根据目标识别算法获取画面中跟踪目标的像素值，当目标边界框宽高值中的较大值超出设置的预设的30至100像素这一最优区间时，触发自动变倍操作，根据当前新的变倍参数，实时查询已标定的跟焦曲线参数，调用对应的理想聚焦参数，驱动镜头快速完成自动聚焦，确保在整个跟踪跟踪过程中画面的清晰。 ## 1.4 软件功能 ### 一、监控模块 1、开机自检处理过程：a）设备上电触发开机自检；b)收集各设备的实时状态，经解析后汇总为开机自检状态c）将自检结果上报至指控。 2、周期自检处理过程：a）系统上电完成开机自检后，则进入周期自检：b）周期性收集各设备状态，经解析后汇总为周期自检状态；c）将自检结果上报至指控。 3、日志生成处理过程： a）对操作信息进行记录；b）将接收到的状态数据信息（包括：目标脱靶量数据、距离、绝对时信息、跟踪方式和设备工作状态等信息）和操作信息（包括：操作人员操控步骤、时刻及累计开机时间），按照日志文件保存路径进行文件保存。 4、状态信息上报处理过程： a)接收算法模块输出的目标信息和光电设备各硬件模块上发的设备状态数据信息；b）汇总各类信息，根据通信协议将其封装进通信数据帧，上报至指控等。 ### 二、相机控制模块 1、手动变倍处理过程： a)指控下发可见光/红外相机变倍控制指令；b）相机控制模块解析变倍控制指令，并封装下发至相应相机；c)可见光/红外相机执行变倍指令。 2、手动聚焦处理过程： a)指控下发可见光/红外相机调焦控制指令；b）相机控制模块解析调焦控制指令，并封装下发至相应相机；c）可见光/红外相机执行调焦指令。 3、自动变倍处理过程： a)指控下发自动变倍指令（默认自动变倍开启）；b）目标跟踪过程中，每帧均计算目标像素大小；c）当目标像素大小超出预设值，向相机下发变倍指令，直至目标像素大小在预设区间内，则停止指令下发； 4、自动聚焦处理过程：a）接收指控下发的自动聚焦指令；b)每次进行变倍操作后，读取配置文件，根据已标校的跟焦曲线中当前焦距值对应的调焦值，向相机下发调焦指令； 5、电子透雾处理过程：a)指控下发可见光相机电子透雾指令；b）相机控制模块解析电子透雾指令，并封装下发至相应相机；c）可见光相机执行电子透雾指令。 6、预置位设置处理过程：a）接收到上位机/指控下发的预置位设置指令：b）读取并记录当前系统焦距、调焦、增益值；c）将该组状态数据与指令指定的预置位编号进行绑定并存储至配置文件；d）向上位机/指控反馈设置成功的信息。 7、跟焦曲线标定处理过程：a）一键跟焦曲线标定指令来源指控接收到指控的跟焦曲线标定指令；b）控制相机变倍至最长焦，然后每间隔30mm（预设值可进行调整）向短焦方向变倍；c）在每个变倍位置，执行相机聚焦操作，记录下当前焦距值及其对应的最佳聚焦值。d）将所有采集到的焦距-聚焦值存储至配置文件；e）向指控反馈标定成功的信息。 ### 三、测距模块 1、激光测距处理过程： a)指控下发激光测距机控制指令；b）软件解析后转发至激光测距机：c）激光测距机返回测距信息：d）输出测距距离信息到指控。 2、激光禁射区域设置处理过程a）接收到指控下发的激光禁射区域设置指令和方位区间值；b）下发激光测距指令前，判断当前伺服方位值是否在禁射区间内，若在该区间内，则不进行激光测距指令下发。 ### 四、算法模块 1、目标检测识别处理过程： a)指控下发目标检测指令至信息处理软件；b）目标检测开启控制命令触发开启目标检测功能，目标检测可接收图像进行处理。c）输入图像预处理，具体为将红外可见光图像缩放至640*512；d）将缩放后图像送入已训练好且参数固定的AI神经网络模型推理器，模型对图像层卷积和降采样，级联地提取特征得到最终特征图；e)对特征图进行后处理解算得到最终检测目标信息，包含目标定位框、置信度和目标类别信息，检测的目标类别，可检测目标类别包括：旋翼无人机、固定翼无人机、民航飞机、直升机、热气球、气球、鸟；f)对识别目标进行计数；g）输出目标信息输出到指控。 2、目标跟踪处理过程： （1）手动跟踪处理过程：a)指控下发目标跟踪指令至信息处理软件；b)手动选择需要跟踪的目标；c）检测跟踪位置是否存在无人机目标;d）不存在目标进入模板跟踪，存在目标进入检测跟踪；e）对目标持续跟踪;f）丢失目标进入记忆跟踪，重新捕获继续跟踪；g)记忆跟踪未捕获目标或手动释放跟踪，退出跟踪。 （2）自动跟踪处理过程：a)指控下发目标自动跟踪指令至信息处理软件；b）检测图像中的无人机目标；记录每个目标的轨迹；d）判断是否存在连续目标轨迹；e)不存在连续目标轨迹则继续检测目标，存在连续目标轨迹选择置信度最大的目标作为主跟踪目标；f）上报目标信息，进入检测跟踪；g）对目标持续跟踪；h）丢失目标进入记忆跟踪，重新捕获继续跟踪；i）记忆跟踪未捕获目标或手动释放跟踪，退出跟踪。 （3）记忆跟踪处理过程：a)在进入目标跟踪状态后，目标受到遮挡等因素丢失后，进入记忆跟踪；b）保持伺服方位俯仰运动状态4s；c）记忆跟踪重新捕获目标后按原有目标跟踪方式继续跟踪;d）记忆跟踪超过4s未捕获目标则退出跟踪，停止伺服运动。 ### 五、显示模块 1、OSD叠加处理过程： a)接收到指控的OSD叠加控制指令；b）根据目标检测算法得到的目标坐标、类别信息和测距得到的目标距离信息，框出所检测目标，并叠加类别和距离信息在目标框上方；c）在视场中心叠加十字叉丝，代表系统光轴方向；d）将叠加OSD信息后视频编码推流，输出至指控。 2、视频压缩处理过程：a)将可见光视频和红外视频进行压缩并优化。压缩后两路视频流小于4Mb/s，分辨率不低于640*512，帧率不低于24帧；b）压缩后视频编码推流，输出至指控（用于指控端进行无线电传输，传至指控端共4路视频流）。 ## 1.5 功能驻留划分 信息处理软件主要驻留在综合处理组件上，包括1片RK3588和2片Atlas(1片预留给用户)；其中RK3588作为主控，实现综合控制、自检、手动/自动变倍聚焦、识别跟踪等功能；Atlas200A2实现AI单/多目标检测功能。RK3588J和Atlas200A2都运行Linux操作系统Ubuntu20.04，驱动PCIE、网口、UART、EMMC等基础外设。使用LAN 实现三块板卡之间通信。三片Soc挂在同一交换机芯片上，外部通过同一网口访问。
